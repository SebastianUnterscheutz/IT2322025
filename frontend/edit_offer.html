<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Angebot bearbeiten</title>
</head>
<body>
<h1>Angebot bearbeiten</h1>
<form id="editForm">
    <label>Name: <input type="text" id="name" name="name"></label><br>
    <label>Vorname: <input type="text" id="first_name" name="first_name"></label><br>
    <label>E-Mail: <input type="email" id="email" name="email"></label><br>
    <label>Telefon: <input type="text" id="phone_number" name="phone_number"></label><br>
    <label>Gültig von: <input type="date" id="valid_from" name="valid_from"></label><br>
    <label>Gültig bis: <input type="date" id="valid_until" name="valid_until"></label><br>
    <label>Zusätzliche Informationen: <textarea id="additional_information" name="additional_information"></textarea></label><br>
    <button type="submit">Speichern</button>
</form>
<script>
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');

    window.onload = function() {
        fetch(`/api/edit/offer?token=${token}`)
            .then(response => response.json())
            .then(data => {
                document.getElementById('name').value = data.name;
                document.getElementById('first_name').value = data.first_name;
                document.getElementById('email').value = data.email;
                document.getElementById('phone_number').value = data.phone_number;
                document.getElementById('valid_from').value = data.valid_from;
                document.getElementById('valid_until').value = data.valid_until;
                document.getElementById('additional_information').value = data.additional_information;
            });
    };

    document.getElementById('editForm').onsubmit = function(e) {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());
        data.token = token;

        fetch('/api/edit/offer', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        }).then(response => {
            if (response.ok) {
                alert('Angebot erfolgreich aktualisiert.');
            } else {
                alert('Fehler beim Aktualisieren des Angebots.');
            }
        });
    };
</script>
</body>
</html>